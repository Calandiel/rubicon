TODO:

- handle disconnects (in any order, for both tcp and udp)
- handle udp
